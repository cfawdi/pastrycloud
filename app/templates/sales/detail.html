{% extends "base.html" %}
{% block title %}Sale #{{ sale.id }} - {{ shop_name }}{% endblock %}
{% block page_title %}Sale #{{ sale.id }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
  <div class="card bg-base-200 shadow">
    <div class="card-body">
      <!-- Header -->
      <div class="flex justify-between items-start mb-4">
        <div>
          <h2 class="text-xl font-bold">{{ shop_name }}</h2>
          <p class="text-sm opacity-60">Sale Receipt</p>
        </div>
        <div class="text-right">
          <p class="font-mono text-sm">Sale #{{ sale.id }}</p>
          <p class="text-sm opacity-60">{{ sale.sale_date.strftime('%B %d, %Y') }}</p>
          <p class="text-sm opacity-60">{{ sale.created_at.strftime('%H:%M') }}</p>
        </div>
      </div>

      <div class="divider my-2"></div>

      <!-- Customer + Payment info -->
      <div class="flex justify-between text-sm mb-4">
        <div>
          {% if sale.customer_name %}
          <p><span class="opacity-60">Customer:</span> {{ sale.customer_name }}</p>
          {% endif %}
          <p><span class="opacity-60">Payment:</span>
            <span class="badge badge-ghost badge-sm">{{ sale.payment_method }}</span>
          </p>
        </div>
      </div>

      <!-- Items -->
      <div class="overflow-x-auto">
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Product</th>
              <th class="text-right">Price</th>
              <th class="text-right">Qty</th>
              <th class="text-right">VAT</th>
              <th class="text-right">Total</th>
            </tr>
          </thead>
          <tbody>
            {% for item in sale.items %}
            <tr>
              <td>{{ item.product.name }}</td>
              <td class="text-right">{{ "%.2f"|format(item.unit_price) }} {{ currency }}</td>
              <td class="text-right">{{ item.quantity|int }}</td>
              <td class="text-right">{{ item.vat_rate }}%</td>
              <td class="text-right font-medium">{{ "%.2f"|format(item.line_total) }} {{ currency }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="divider my-2"></div>

      <!-- Totals -->
      <div class="space-y-1 text-sm max-w-xs ml-auto">
        <div class="flex justify-between">
          <span>Subtotal</span>
          <span>{{ "%.2f"|format(sale.total_amount - sale.vat_amount) }} {{ currency }}</span>
        </div>
        <div class="flex justify-between text-warning">
          <span>VAT</span>
          <span>{{ "%.2f"|format(sale.vat_amount) }} {{ currency }}</span>
        </div>
        <div class="flex justify-between font-bold text-lg pt-1 border-t border-base-300">
          <span>Total</span>
          <span class="text-primary">{{ "%.2f"|format(sale.total_amount) }} {{ currency }}</span>
        </div>
      </div>

      {% if sale.notes %}
      <div class="mt-4 text-sm opacity-60">
        <p><strong>Notes:</strong> {{ sale.notes }}</p>
      </div>
      {% endif %}

      <!-- Actions -->
      <div class="flex justify-between mt-6">
        <a href="{{ url_for('sales.index') }}" class="btn btn-ghost btn-sm">Back to Sales</a>
        <button onclick="window.print()" class="btn btn-outline btn-sm gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
          </svg>
          Print
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
